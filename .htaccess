# ============================================
# CONFIGURACIÓN DE SEGURIDAD - Sistema CAPA
# Versión simplificada para DonWeb
# ============================================

# Habilitar RewriteEngine
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Forzar HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# ============================================
# PROTECCIÓN DE ARCHIVOS SENSIBLES
# ============================================

# Denegar acceso a archivo .env
<FilesMatch "^\.env">
    Order allow,deny
    Deny from all
</FilesMatch>

# Denegar acceso a archivos de configuración
<FilesMatch "^(config|csrf|conector)\.php$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Denegar acceso a archivos de backup
<FilesMatch "\.(bak|old|backup|swp|~)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Denegar acceso a archivos del sistema
<FilesMatch "^(\.htaccess|\.htpasswd|\.DS_Store|Thumbs\.db)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# ============================================
# PREVENIR LISTADO DE DIRECTORIOS
# ============================================
Options -Indexes

# ============================================
# HEADERS DE SEGURIDAD BÁSICOS
# ============================================

<IfModule mod_headers.c>
    # Prevenir clickjacking
    Header always set X-Frame-Options "DENY"
    
    # Prevenir MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Habilitar filtro XSS del navegador
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# ============================================
# COMPRESIÓN (Opcional)
# ============================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# ============================================
# FIN DE CONFIGURACIÓN
# ============================================